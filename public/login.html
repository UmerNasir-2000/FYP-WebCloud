<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="landingstyle.css" />

    <title>Web Cloud | Login</title>
    <script type="text/javascript" src="/jquery/jquery.min.js"></script>

    <script type="text/javascript">
      $(document).ready(function () {
        $("#register").click(function (e) {
          e.preventDefault();
          var email = $("#email").val();
          var password = $("#password").val();

          console.log(email, password);

          $.ajax({
            url: `/api/auth/login`,
            method: "POST",

            data: {
              email: email,
              password: password,
            },
            headers: { Authorization: localStorage.getItem("token") },
            success: function (result, status, xhr) {
              if (xhr.responseJSON.msg == "ADMIN USER IDENTIFIED") {
                localStorage.setItem("name", xhr.responseJSON.user.first_name);
                localStorage.setItem(
                  "url",
                  xhr.responseJSON.user.profile_picture_url
                );
                localStorage.setItem("token", xhr.responseJSON.accessToken);

                window.location.href = "admin.html";
              } else {
                // window.location.host = `${xhr.responseJSON.user.first_name}.localhost:5001`;
                // const wholeURL = `${window.location.protocol}//${window.location.host}/landing.html`;
                // alert(wholeURL);
                window.location.href = `http://${xhr.responseJSON.user.first_name.toLowerCase()}.localhost:5001/landing.html`;
                localStorage.setItem("name", xhr.responseJSON.user.first_name);
                localStorage.setItem(
                  "url",
                  xhr.responseJSON.user.profile_picture_url
                );
                localStorage.setItem("token", xhr.responseJSON.accessToken);
                //window.location.replace(wholeURL);
                //window.location.hostname = "umer.localhost:5001";
              }
            },
            error: function (xhr, status, error) {
              alert(xhr.responseText);
            },
          });

          $(".error").remove();

          if (email.length < 1) {
            $("#email").before(
              '<span style="font-size:10pt ;color: red;" class="error">This field is required</span>'
            );
          }
          if (password.length < 1) {
            $("#password").before(
              '<span style="font-size:10pt; color: red;" class="error">This field is required</span>'
            );
          }
        });
      });
    </script>
  </head>
  <body>
    <nav
      class="navbar navbar-light"
      style="
        margin-left: auto;
        background-color: rgb(15, 23, 36);
        align-content: space-between;
        padding: 10px;
      "
    >
      <h1
        class="display-6"
        style="font-size: 40px; color: white; font-weight: bolder"
      >
        &lt;/&gt;WebCloud
      </h1>
    </nav>
    <div class="login-page">
      <div class="form">
        <form class="register-form">
          <label for="email" class="Text">Email</label>
          <input
            type="email"
            name="email"
            placeholder="Enter email"
            id="email"
          />
          <label for="password" class="Text">Password</label>
          <input
            type="password"
            name="password"
            placeholder="Enter password"
            id="password"
          />
          <button type="button" id="register">Login</button>
          <p class="message">
            Don't have account ? <a href="/signup.html">SignUP</a>
          </p>
        </form>
      </div>
    </div>
    <section class="footer">
      <div class="box-container">
        <div class="box">
          <h3>Why choose us?</h3>
          <p>You can code any where any time without environmental setup</p>
        </div>

        <div class="box">
          <h3>Quick Links</h3>
          <a style="text-decoration: none" href="landing.html">home</a>
          <a style="text-decoration: none" href="userguide.html">about</a>
          <a style="text-decoration: none" href="#">contact</a>
          <a style="text-decoration: none" href="userguide.html">FAQ</a>
        </div>

        <div class="box">
          <h3>Contact Us</h3>
          <p><i class="fas fa-map-marker-alt"></i>SZABIST 100</p>
          <p><i class="fas fa-globe"></i> www.webcloud.com</p>
          <p><i class="fas fa-phone"></i> +123-456-7890.</p>
        </div>
      </div>

      <h1 class="credit">
        Created By
        <a style="text-decoration: none" href="#">Umer And Wahaj</a> | All
        Rights Reserved.
      </h1>
    </section>
  </body>
</html>
