<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="./favicon-32x32.png" />
    <script type="text/javascript" src="/jquery/jquery.min.js"></script>
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="admins.css" />
    <link rel="stylesheet" href="navbar.css" />
    <link rel="stylesheet" href="footer.css" />
    <script type="text/javascript" src="/jquery/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <script
      type="text/javascript"
      src="/bootstrap/js/bootstrap.min.js"
    ></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.0/beautify.min.js"
      integrity="sha512-aVeS8p7lnH8hSLlG8zNWY/7qE3ZC1lgtZi00woKJpPwN8dw+kH3TSkxNzdFlgUxy5JYgdWIZhBIRZKzAIn698g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.0/beautify.min.js"
      integrity="sha512-aVeS8p7lnH8hSLlG8zNWY/7qE3ZC1lgtZi00woKJpPwN8dw+kH3TSkxNzdFlgUxy5JYgdWIZhBIRZKzAIn698g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdn.socket.io/4.4.1/socket.io.min.js"
      integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H"
      crossorigin="anonymous"
    ></script>
    <script>
      $(document).ready(function () {
        $("#mycanvas1").hide();
        $("#web").hide();

        // var socket = io();
        // socket.on("connection");
        // socket.on("admin", (data) => {
        //   console.log(data);
        //   console.log("Inside Admin");
        // });

        $(".standard-select").on("change", function () {
          if (this.value === "WebEngine") {
            $("#mycanvas").hide();
            $("#mycanvas1").show();
            $("#db").hide();
            $("#web").show();
          } else {
            $("#db").show();
            $("#web").hide();
            $("#mycanvas1").hide();
            $("#mycanvas").show();
          }
        });

        $.ajax({
          url: `/api/admin/dashboard`,
          method: "GET",
          headers: { Authorization: `Bearer ${localStorage.getItem("token")}` },
        }).then(function (res) {
          $("#tblReg  > .wrapper > .box1").empty();
          let tc = `
          <div class="infotxt">

            <img src="https://img.icons8.com/doodle/50/000000/group.png"/>
            Total Users

            <h2>
              ${res.totalUsers}
              </h2>

            </div>
          <div class="infotxt">
            <img src="https://img.icons8.com/doodle/50/000000/folded-booklet.png"/>
            Total Project Templates
            <h2>

              ${res.projectTemplates}
              </h2>
            </div>
          <div class="infotxt">
            <img src="https://img.icons8.com/external-flaticons-lineal-color-flat-icons/50/000000/external-project-crowdfunding-flaticons-lineal-color-flat-icons-6.png"/>
            Total Projects
            <h2>
              ${res.totalProjects}
              </h2>
             </div>
          <div class="infotxt">

            <img src="https://img.icons8.com/stickers/50/000000/connection-status-off.png"/>  Pending Requests
            <h2>
            10
              </h2>

            </div>`;
          $("#tblReg  > .wrapper > .box1").append(tc);
          $("#tblReg  > .wrapper > .box2 > table > tbody").empty();
          $.each(res.requests, function (r1, reg) {
            // console.log(reg);
            var str = reg.createdAt;

            if (str.length > 5) str = str.substring(0, 10);
            // console.log(reg);
            let tryString = reg.id + " Approved";
            console.log(tryString);

            let tr = `
          <tr>
                <td>${reg.id}</td>
                <td>${reg.project_name}</td>
                <td id="yes">
                  <select class="standard-select1" id="status" >
                    <option  value="#">${reg.status}</option>
                    <option  value=${reg.id}>Approved</option>
                    <option value="Rejected">Rejected</option>
                  </select>
                </td>
                <td>${reg.first_name}</td>
                <td style="font-size:smaller">
                  ${str}</td>
              </tr>

          `;
            $("#tblReg > .wrapper > .box2 > table > tbody").append(tr);

            // console.log(res.totalProjects);
          });
          $(
            "#tblReg > .wrapper > .box2 > table > tbody >tr > #yes > #status"
          ).on("change", function () {
            console.log("Are u correct.?");
            console.log(this.value);
            let a = $("#status :selected").text();
            console.log("I am ");
            console.log(a);
            $.ajax({
              url: `/api/admin/request/${this.value.split(" ")[0]}`,
              method: "PUT",
              data: {
                project_id: this.value.split(" ")[0],
                project_status: a,
              },
              beforeSend: function (xhr) {
                xhr.setRequestHeader(
                  "Authorization",
                  `Bearer ${localStorage.getItem("token")}`
                );
              },
            }).then(function (res) {
              alert("Updated");
              console.log(res);
              console.log(this.value);
            });
          });
        });
        var ctx = $("#mycanvas").get(0).getContext("2d");
        var ctx1 = $("#mycanvas1").get(0).getContext("2d");

        //pie chart data
        //sum of values = 360
        // #0E1525;
        // #2B3245;

        var data1 = [
          {
            value: 90,
            color: "navy",
            highlight: "coral",
            label: "Corn Flower Blue",
          },
          {
            value: 90,
            color: "green",
            highlight: "yellowgreen",
            label: "Lightgreen",
          },
          {
            value: 90,
            color: "lightgreen",
            highlight: "coral",
            label: "Corn Flower Blue",
          },

          {
            value: 90,
            color: "rgb(214, 60, 60)",
            highlight: "coral",
            label: "Corn Flower Blue",
          },
          {
            value: 90,
            color: "lightblue",
            highlight: "yellowgreen",
            label: "Lightgreen",
          },
        ];

        //draw
        var piechart = new Chart(ctx).Pie(data);
        var piechart1 = new Chart(ctx1).Pie(data1);

        $("#ddlEntity").on("change", function () {
          console.log($("#ddlEntity :selected").text());
          $.ajax({
            url: `/api/admin/charts/`,
            method: "POST",
            data: {
              entity: $("#ddlEntity :selected").val(),
            },
            beforeSend: function (xhr) {
              xhr.setRequestHeader(
                "Authorization",
                `Bearer ${localStorage.getItem("token")}`
              );
            },
          }).then((res) => {
            console.log(res.configuration[0].total_web_framework);
          });
        });
      });
    </script>
    <title style="color: aliceblue">Document</title>
  </head>
  <body>
    <nav class="navbar" style="padding: 0px 15px; background-color: #0e1528">
      <a class="navbar-brand" href="#">
        <img src="images/four.svg" height="50px" width="50px" alt="" />
      </a>
      <div style="justify-content: end !important">
        <ul
          class="navbar-nav"
          style="flex-direction: row; justify-content: flex-end !important"
        >
          <div class="section">
            <div class="top_navbar">
              <div class="bars">
                <a href="#">
                  <i class="fas fa-bars"></i>
                </a>
              </div>
            </div>
          </div>
        </ul>
      </div>
    </nav>
    <div class="sidebar-parent">
      <div class="sidebar-child">
        <div class="sidebar-pic">
          <a id="mypic" href=""></a>
        </div>

        <li>
          <button id="uname" class="btn-mini-side"></button>
        </li>
        <li>
          <button id="logout" class="btn-mini-side">
            <a style="color: rgba(255, 0, 0, 0.671)" target="_blank">LOGOUT</a>
          </button>
        </li>
      </div>
    </div>
    <div class="outer-grid" id="tblReg">
      <h4 style="font-size: 30pt; color: white; text-align: center">
        ADMIN DASHBOARD
      </h4>

      <div class="wrapper">
        <div class="box1"></div>
        <div class="box2">
          <h4 style="font-size: 20pt; color: white">PROJECTS REQUESTS</h4>
          <table class="styled-table" style="table-layout: fixed; width: 90%">
            <thead>
              <tr style="color: white; font-size: 15pt">
                <th>Project ID</th>
                <th>Project Name</th>
                <th>Project Status</th>
                <th>Created By</th>
                <th>Created At</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div
          class="box3"
          style="
            align-items: center;
            text-align: center;
            justify-content: center;
          "
        >
          <div
            style="
              display: flex;
              flex-direction: row;
              justify-content: space-evenly;
              align-items: center; ;
            "
          >
            <p style="font-size: large; padding-top: 10px; font-display: bold">
              Analysis based on :
            </p>
            <select class="standard-select" id="ddlEntity">
              <option id="1" value="database">Database</option>
              <option id="2" value="web_framework">Web Engine</option>
            </select>
          </div>
          <div style="padding-top: 20px" class="b3">
            <div>
              <canvas
                id="mycanvas"
                width="256"
                height="256"
                style="border: 0 !important"
              ></canvas>
              <div
                id="db"
                style="
                  display: flex;
                  flex-direction: row;
                  gap: 10px;
                  padding-left: 10px;
                "
              >
                <div
                  style="height: 20px; width: 10px; background-color: navy"
                ></div>
                MySQL
                <div
                  style="height: 20px; width: 10px; background-color: green"
                ></div>
                MongoDB
              </div>
            </div>
            <div>
              <canvas
                id="mycanvas1"
                width="256"
                height="256"
                style="border: 0 !important"
              ></canvas>
              <div
                id="web"
                style="
                  display: flex;
                  flex-direction: row;
                  gap: 2px;
                  padding-left: 5px;
                "
              >
                <div
                  style="height: 20px; width: 10px; background-color: lightblue"
                ></div>
                PHP
                <div
                  style="height: 20px; width: 10px; background-color: blue"
                ></div>
                Dotnet

                <div
                  style="height: 20px; width: 10px; background-color: green"
                ></div>
                Nodejs
                <div
                  style="
                    height: 20px;
                    width: 10px;
                    background-color: rgb(214, 60, 60);
                  "
                ></div>
                Nest.js
                <div
                  style="
                    height: 20px;
                    width: 10px;
                    background-color: lightgreen;
                  "
                ></div>
                SpringBoot
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <section class="footer">
      <div class="box-container">
        <div class="box">
          <h3>Why choose us?</h3>
          <p>You can code any where any time without environmental setup</p>
        </div>

        <div class="box">
          <h3>Quick Links</h3>
          <a style="text-decoration: none" href="landing.html">home</a>
          <a style="text-decoration: none" href="userguide.html">about</a>
          <a style="text-decoration: none" href="#">contact</a>
          <a style="text-decoration: none" href="userguide.html">FAQ</a>
        </div>

        <div class="box">
          <h3>Contact Us</h3>
          <p><i class="fas fa-map-marker-alt"></i>SZABIST 100</p>
          <p><i class="fas fa-globe"></i> www.webcloud.com</p>
          <p><i class="fas fa-phone"></i> +123-456-7890.</p>
        </div>
      </div>

      <h1 class="credit">
        created by
        <a style="text-decoration: none" href="#">Umer And Wahaj</a> | all
        rights reserved.
      </h1>
    </section>

    <script src="navbar.js"></script>
    <script src="chart.js"></script>
    <!-- <script src="adminRequests.js"></script> -->
    <script></script>
  </body>
</html>
